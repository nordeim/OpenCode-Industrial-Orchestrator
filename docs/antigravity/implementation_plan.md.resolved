# Phase 2.3: Dashboard & Visualization — Implementation Plan

## Executive Summary

**Goal**: Provide a "Glass Box" interface for monitoring orchestration in real-time with a **Brutalist Minimalism** aesthetic.

**Scope**:
1. **2.3.A** — Backend WebSocket support for real-time updates
2. **2.3.B** — Next.js 14 foundation with Tailwind + Shadcn
3. **2.3.C** — Dashboard pages (overview, sessions, agents, tasks)
4. **2.3.D** — Frontend API services and WebSocket hooks

**Design Philosophy**:
- **Industrial Cybernetics**: Utilitarian, transparent, efficient
- **Brutalist Minimalism**: Raw elements, stark contrasts, mono typography
- **Glass Box**: Full visibility into orchestration state

---

## User Review Required

> [!IMPORTANT]
> **Frontend Framework Confirmation**: The plan uses Next.js 14 (App Router) with Tailwind CSS 4.0 and Shadcn UI. Please confirm this is acceptable or specify alternatives.

> [!WARNING]
> **Real-time Updates**: WebSocket implementation requires the API server to support concurrent connections. The current FastAPI setup supports this natively.

---

## Phase 2.3.A — Backend WebSocket Support

### [NEW] `presentation/api/websocket/connection_manager.py`

**Purpose**: Thread-safe WebSocket connection pool with room-based broadcasting.

**Features**:
- Connection lifecycle management
- Room/channel subscriptions
- Broadcast and direct messaging
- Heartbeat keep-alive

**Interface**:
```python
class ConnectionManager:
    async def connect(websocket: WebSocket, client_id: str, rooms: List[str] = None)
    async def disconnect(client_id: str)
    async def broadcast(message: Dict, room: Optional[str] = None)
    async def send_personal(client_id: str, message: Dict)
    async def heartbeat_loop()
```

**Checklist**:
- [ ] Create `ConnectionManager` with dict-based storage
- [ ] Implement connection/disconnection with cleanup
- [ ] Add room-based broadcast filtering
- [ ] Implement heartbeat mechanism (30s interval)
- [ ] Add connection count metrics

---

### [NEW] `presentation/api/websocket/events.py`

**Purpose**: WebSocket endpoints for real-time events.

**Endpoints**:
- `/ws/sessions/{session_id}` — Single session updates
- `/ws/sessions` — All session updates
- `/ws/agents` — Agent status changes
- `/ws/system` — System health events

**Message Format**:
```json
{
  "type": "session.status_changed" | "agent.heartbeat" | "task.progress",
  "payload": { ... },
  "timestamp": "2026-02-03T16:00:00Z"
}
```

**Checklist**:
- [ ] Create WebSocket router
- [ ] Implement session-specific subscriptions
- [ ] Implement broadcast endpoints
- [ ] Add token authentication (optional)

---

### [MODIFY] [presentation/api/main.py](file:///home/project/opencode-industrial-orchestrator/orchestrator/src/industrial_orchestrator/presentation/api/main.py)

**Changes**:
- Mount WebSocket router at `/ws`
- Initialize ConnectionManager on startup
- Add WebSocket cleanup on shutdown

**Checklist**:
- [ ] Add WebSocket router to app
- [ ] Initialize connection manager in lifespan
- [ ] Add WebSocket exception handlers

---

## Phase 2.3.B — Next.js Frontend Foundation

### [NEW] `dashboard/` Project Structure

```
dashboard/
├── package.json
├── next.config.mjs
├── tailwind.config.ts
├── postcss.config.mjs
├── tsconfig.json
├── src/
│   ├── app/
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   ├── globals.css
│   │   ├── sessions/
│   │   ├── agents/
│   │   └── tasks/
│   ├── components/
│   │   ├── ui/           # Shadcn primitives
│   │   ├── layout/       # Header, Sidebar
│   │   └── dashboard/    # Domain components
│   └── lib/
│       ├── api/          # API client
│       └── websocket/    # WS hooks
```

---

### [NEW] `dashboard/package.json`

**Core Dependencies**:
```json
{
  "dependencies": {
    "next": "^14.1.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@tanstack/react-query": "^5.0.0",
    "socket.io-client": "^4.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    "lucide-react": "^0.312.0",
    "date-fns": "^3.0.0"
  },
  "devDependencies": {
    "typescript": "^5.3.0",
    "tailwindcss": "^3.4.0",
    "postcss": "^8.4.0",
    "autoprefixer": "^10.4.0"
  }
}
```

**Checklist**:
- [ ] Initialize with `npx create-next-app@14 --typescript --tailwind --app`
- [ ] Install React Query for data fetching
- [ ] Install Socket.IO client for WebSocket
- [ ] Install Lucide for icons

---

### [NEW] `dashboard/tailwind.config.ts`

**Brutalist Theme**:
```typescript
const config = {
  theme: {
    extend: {
      colors: {
        // Industrial palette
        'industrial-black': '#0a0a0a',
        'industrial-white': '#fafafa',
        'industrial-gray': '#1a1a1a',
        'status-running': '#22c55e',
        'status-pending': '#eab308',
        'status-failed': '#ef4444',
        'status-completed': '#3b82f6',
      },
      fontFamily: {
        mono: ['JetBrains Mono', 'Menlo', 'monospace'],
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      borderRadius: {
        'none': '0px',  // Brutalist: no rounded corners
      },
      boxShadow: {
        'brutal': '4px 4px 0px 0px rgba(0,0,0,1)',
        'brutal-sm': '2px 2px 0px 0px rgba(0,0,0,1)',
      },
    },
  },
}
```

**Checklist**:
- [ ] Define industrial color palette
- [ ] Configure mono typography (JetBrains Mono)
- [ ] Remove all rounded corners (brutal aesthetic)
- [ ] Add brutal shadow utilities
- [ ] Configure dark mode (class-based)

---

### [NEW] `dashboard/src/app/globals.css`

**Brutalist Base Styles**:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: 10 10 10;
  --foreground: 250 250 250;
  --border: 38 38 38;
}

* { border-radius: 0 !important; }

body {
  font-family: 'JetBrains Mono', monospace;
  background: rgb(var(--background));
  color: rgb(var(--foreground));
}
```

**Checklist**:
- [ ] Set dark industrial background
- [ ] Configure CSS variables for theming
- [ ] Force zero border-radius globally
- [ ] Add industrial typography

---

### [NEW] `dashboard/src/app/layout.tsx`

**Root Layout**:
```tsx
export default function RootLayout({ children }) {
  return (
    <html lang="en" className="dark">
      <body>
        <QueryClientProvider client={queryClient}>
          <WebSocketProvider>
            <div className="flex min-h-screen">
              <Sidebar />
              <main className="flex-1">{children}</main>
            </div>
          </WebSocketProvider>
        </QueryClientProvider>
      </body>
    </html>
  )
}
```

**Checklist**:
- [ ] Add QueryClientProvider for React Query
- [ ] Add WebSocketProvider context
- [ ] Configure app shell with sidebar
- [ ] Load Google Fonts (JetBrains Mono, Inter)

---

### [NEW] Shadcn UI Components

**Components to Install**:
| Component | Customization |
|-----------|---------------|
| Button | Brutal shadow, sharp edges, mono text |
| Card | 2px border, no radius, brutal shadow |
| Table | Industrial grid, alternating rows |
| Badge | Status colors, uppercase, bold |
| Dialog | Sharp modal with brutal border |
| Sheet | Mobile sidebar |

**Checklist**:
- [ ] Run `npx shadcn-ui@latest init`
- [ ] Install: button, card, table, badge, dialog, sheet
- [ ] Customize each for brutalist aesthetic
- [ ] Create industrial variants

---

## Phase 2.3.C — Dashboard Pages

### [NEW] `dashboard/src/app/page.tsx` — Overview

**Layout**:
```
┌─────────────────────────────────────────────────────┐
│  INDUSTRIAL ORCHESTRATOR         [HEALTH: NOMINAL] │
├─────────────────────────────────────────────────────┤
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │ ACTIVE  │ │ PENDING │ │COMPLETED│ │ FAILED  │   │
│  │   12    │ │    8    │ │   156   │ │    3    │   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
├─────────────────────────────────────────────────────┤
│  ACTIVE SESSIONS                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ Session-Alpha-001   RUNNING   5m ago    ▶   │  │
│  │ Session-Beta-002    RUNNING   12m ago   ▶   │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**Checklist**:
- [ ] Create statistics cards (4-grid)
- [ ] Create active sessions table
- [ ] Add system health indicator
- [ ] Wire up real-time updates

---

### [NEW] `dashboard/src/app/sessions/page.tsx`

**Features**:
- Filterable session table
- Status filter chips
- Search by title
- Create session dialog

**Checklist**:
- [ ] Create SessionsTable component
- [ ] Add StatusFilter component
- [ ] Add SearchInput component
- [ ] Create CreateSessionDialog
- [ ] Implement pagination

---

### [NEW] `dashboard/src/app/sessions/[id]/page.tsx`

**Features**:
- Session metadata header
- Action buttons (start/pause/cancel)
- Checkpoint timeline
- Live metrics

**Checklist**:
- [ ] Create SessionHeader component
- [ ] Create ActionButtons group
- [ ] Create CheckpointTimeline
- [ ] Add real-time status updates

---

### [NEW] `dashboard/src/app/agents/page.tsx`

**Features**:
- Agent cards grid
- Load gauges
- Performance sparklines
- Register/deregister actions

**Checklist**:
- [ ] Create AgentCard component
- [ ] Create LoadGauge visualization
- [ ] Add performance metrics display
- [ ] Wire up registration flow

---

### [NEW] `dashboard/src/app/tasks/page.tsx`

**Features**:
- Task dependency DAG visualization
- Task detail panel
- Status filtering

**Checklist**:
- [ ] Integrate ReactFlow for DAG (or simple list initially)
- [ ] Create TaskNode component
- [ ] Add task detail sidebar
- [ ] Wire up decomposition display

---

## Phase 2.3.D — Frontend Services

### [NEW] `dashboard/src/lib/api/client.ts`

**Features**:
```typescript
const apiClient = {
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  
  sessions: {
    list: (params) => get('/api/v1/sessions', params),
    get: (id) => get(`/api/v1/sessions/${id}`),
    create: (data) => post('/api/v1/sessions', data),
    start: (id) => post(`/api/v1/sessions/${id}/start`),
  },
  agents: { ... },
  tasks: { ... },
}
```

**Checklist**:
- [ ] Create fetch wrapper with base URL
- [ ] Add request/response interceptors
- [ ] Add error handling with typed errors
- [ ] Export typed API methods

---

### [NEW] `dashboard/src/lib/api/hooks.ts`

**React Query Hooks**:
```typescript
export function useSessions(params) {
  return useQuery({ queryKey: ['sessions', params], queryFn: ... })
}

export function useSession(id: string) {
  return useQuery({ queryKey: ['sessions', id], queryFn: ... })
}

export function useCreateSession() {
  return useMutation({ mutationFn: ..., onSuccess: invalidate })
}
```

**Checklist**:
- [ ] Create `useSessions` list hook
- [ ] Create `useSession` detail hook
- [ ] Create mutation hooks with optimistic updates
- [ ] Add `useAgents` and `useTasks` hooks

---

### [NEW] `dashboard/src/lib/websocket/provider.tsx`

**WebSocket Context**:
```typescript
const WebSocketContext = createContext<WebSocketState>(null)

export function WebSocketProvider({ children }) {
  const socket = useRef<Socket>(null)
  
  useEffect(() => {
    socket.current = io(WS_URL, { transports: ['websocket'] })
    return () => socket.current?.disconnect()
  }, [])
  
  return (
    <WebSocketContext.Provider value={{ socket: socket.current, connected }}>
      {children}
    </WebSocketContext.Provider>
  )
}
```

**Checklist**:
- [ ] Create WebSocket context
- [ ] Implement auto-reconnection
- [ ] Add connection status tracking
- [ ] Export `useWebSocket` hook

---

## Execution Order

| Step | Phase | Description | Est. Effort |
|------|-------|-------------|-------------|
| 1 | 2.3.A | WebSocket connection manager | 2h |
| 2 | 2.3.A | WebSocket events router | 1h |
| 3 | 2.3.A | Update main.py with WS support | 30m |
| 4 | 2.3.B | Initialize Next.js project | 30m |
| 5 | 2.3.B | Configure Tailwind brutalist theme | 1h |
| 6 | 2.3.B | Setup Shadcn + customization | 2h |
| 7 | 2.3.B | Create app layout + sidebar | 1h |
| 8 | 2.3.D | Create API client | 1h |
| 9 | 2.3.D | Create React Query hooks | 1h |
| 10 | 2.3.D | Create WebSocket provider | 1h |
| 11 | 2.3.C | Overview page | 2h |
| 12 | 2.3.C | Sessions list page | 2h |
| 13 | 2.3.C | Session detail page | 2h |
| 14 | 2.3.C | Agents page | 2h |
| 15 | 2.3.C | Tasks page | 2h |

**Total Estimated**: ~20 hours

---

## Verification Plan

### Automated Tests
- WebSocket connection manager unit tests
- API client integration tests (mocked)
- Component rendering tests (React Testing Library)

### Manual Verification
1. Start backend API with `uvicorn`
2. Start frontend with `npm run dev`
3. Verify pages load without errors
4. Test real-time updates via WebSocket
5. Test CRUD operations on sessions

---

## Files Summary

| Phase | New Files | Modified Files |
|-------|-----------|----------------|
| 2.3.A | 2 | 1 |
| 2.3.B | 10+ | 0 |
| 2.3.C | 5 | 0 |
| 2.3.D | 4 | 0 |
| **Total** | **21+** | **1** |
